k8up:
  k8up:
    envVars:
      - name: BACKUP_PROMURL
        value: http://prometheus-operated.monitoring-system.svc.cluster.local
      - name: BACKUP_METRICS_BINDADDRESS
        value: 9090
      - name: BACKUP_GLOBAL_OPERATOR_NAMESPACE
        value: backup
      - name: BACKUP_GLOBALREPOPASSWORD
        valueFrom:
          secretKeyRef:
            name: k8up-secrets
            key: repo-password

rclone:
  image:
    repository: rclone/rclone
    tag: "1.63.1"
  init: |
    rclone rcd \
      --rc-no-auth \
      --rc-addr=:5572 &
    
    rclone serve restic koofr:k8up \
      --addr=:50001 &

    wait -n
    exit $?
  service:
    main:
      ports:
        restic:
          enabled: true
          port: 50001
          protocol: TCP
  probes:
    liveness:
      enabled: false
    readiness:
      enabled: false
