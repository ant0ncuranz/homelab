minecraft:
  image:
    tag: 2024.4.1 # keep in sync with initContainer!
  minecraftServer:
    eula: "TRUE"
    type: "PAPER"
    motd: "§aMir ist langweilig, bespaße mich!§r"
    memory: 6G
    maxTickTime: -1 # autopause
    rcon:
      enabled: true
      withGeneratedPassword: true
    serviceType: LoadBalancer
  extraEnv:
    TZ: "Europe/Berlin"
    ENABLE_AUTOPAUSE: true
    AUTOPAUSE_TIMEOUT_EST: 900 # 15min
    AUTOPAUSE_TIMEOUT_INIT: 300 # 5min
    JVM_DD_OPTS: "disable.watchdog:true" # autopause
  persistence:
    storageClass: "local-path"
    dataDir:
      enabled: true
  serviceAnnotations:
    metallb.universe.tf/allow-shared-ip: default

  # autopause hacks
  securityContext:
    allowPrivilegeEscalation: true
    capabilities:
      add: [ "NET_RAW" ]
  initContainers:
    - name: patch-autopause
      image: itzg/minecraft-server:2024.4.1
      command:
        - sh
      args:
        - -c
        - |
          cp /auto/autopause-daemon.sh /patch
          sed -i 's/sudo //g' /patch/autopause-daemon.sh
      volumeMounts:
        - name: patch
          mountPath: /patch
  extraVolumes:
    - volumeMounts:
        - name: patch
          mountPath: /auto/autopause-daemon.sh
          subPath: autopause-daemon.sh
      volumes:
        - name: patch
          emptyDir: {}
