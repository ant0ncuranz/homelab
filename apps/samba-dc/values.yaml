app-template:
  controllers:
    main:
      pod:
#        hostname: samba.ad.serverton.de
#        hostNetwork: true
        dnsConfig:
          nameservers: [ 192.168.1.3 ]
#          runAsUser: 568
#          runAsGroup: 568
#          fsGroup: 568
#          fsGroupChangePolicy: OnRootMismatch

      containers:
        main:
          image:
            repository: instantlinux/samba-dc
            tag: 4.18.8-r0
          securityContext:
            capabilities:
              add: [ "SYS_ADMIN" ]
          env:
#            DOMAIN_ACTION: join
            INTERFACES: lo eth0
            NETBIOS_NAME: samba
            REALM: ad.serverton.de
            SERVER_STRING: Samba Domain Controller
            TZ: Europe/Berlin
            WORKGROUP: WORKGROUP

  persistence:
    etc:
      enabled: true
      accessMode: ReadWriteOnce
      size: 500Mi
      globalMounts:
        - path: /etc/samba
#      annotations:
#        'k8up.io/backup': 'true'

    lib:
      enabled: true
      accessMode: ReadWriteOnce
      size: 500Mi
      globalMounts:
        - path: /var/lib/samba
#      annotations:
#        'k8up.io/backup': 'true'

    samba-admin-password:
      enabled: true
      type: secret
      name: samba-dc-secret
      advancedMounts:
        main:
          main:
            - path: /run/secrets/samba-admin-password
              subPath: samba-admin-password

  service:
    main:
      type: LoadBalancer
      ports:
        http:
          enabled: false
        dns:
          port: 53
          protocol: TCP
        udns:
          port: 53
          protocol: UDP
        kerberos:
          port: 88
          protocol: TCP
        kerberos2:
          port: 464
          protocol: TCP
        ukerberos2:
          port: 464
          protocol: UDP
        ukerberos:
          port: 88
          protocol: UDP
        epm:
          port: 135
          protocol: TCP
        netbios-ns:
          port: 137
          protocol: UDP
        netbios-dgram:
          port: 138
          protocol: UDP
        netbios-session:
          port: 139
          protocol: TCP
        ldap:
          port: 389
          protocol: TCP
        uldap:
          port: 389
          protocol: UDP
        ldaps:
          port: 636
          protocol: TCP
        smb:
          port: 445
          protocol: TCP
        gc:
          port: 3268
          protocol: TCP
        gc-ssl:
          port: 3269
          protocol: TCP

#  ingress:
#    main:
#      enabled: true
#      className: nginx
#      annotations:
#        external-dns.alpha.kubernetes.io/target: "ipv4.serverton.de"
#        cert-manager.io/cluster-issuer: letsencrypt-prod
#      hosts:
#        - host: &host "jellyfin.serverton.de"
#          paths:
#            - path: /
#              service:
#                name: main
#                port: http
#      tls:
#        - secretName: jellyfin-tls-certificate
#          hosts:
#            - *host
