immich:
  image:
    # renovate: datasource=github-releases depName=immich-app/immich
    tag: v1.76.1
  immich:
    persistence:
      library:
        existingClaim: immich-data
  postgresql:
    enabled: true
    primary:
      persistence:
        storageClass: truenas-iscsi
        annotations:
          k8up.io/backup: false
      podAnnotations:
        k8up.io/backupcommand: sh -c 'pg_dumpall -c -U postgres | gzip'
        k8up.io/file-extension: .sql.gz
  redis:
    enabled: true
    master:
      persistence:
        storageClass: truenas-iscsi
        annotations:
          k8up.io/backup: false
  typesense:
    enabled: true
    persistence:
      tsdata:
        enabled: true
        storageClass: truenas-iscsi
        annotations:
          k8up.io/backup: false
  proxy:
    ingress:
      main:
        enabled: true
        ingressClassName: nginx
        annotations:
          external-dns.alpha.kubernetes.io/target: "ipv4.cloudton.de"
          cert-manager.io/cluster-issuer: letsencrypt-prod
        hosts:
          - host: &host "immich.cloudton.de"
            paths:
              - path: /
                pathType: Prefix
        tls:
          - secretName: immich-tls-certificate
            hosts:
              - *host
